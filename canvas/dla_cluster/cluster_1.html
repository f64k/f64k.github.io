<!DOCTYPE html>

<html lang="ru" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <style>

body { 
    background-color: #333;
    margin: 0;
    padding: 0;
    overflow: hidden;
    color: #A9A;
}
canvas.c {
    border: 1px solid white;
}

    </style>
</head>
<body>

<p> Название программы: DLA кластер</p>
 . <canvas id='canvas1' width="480" height="480" class="c"></canvas>
<p> количество точек = <span id='countI'>-</span></p>

</body>
<script>
var countI = document.getElementById('countI');

var canvas = document.getElementById('canvas1');
canvas.oncontextmenu = function() { return false; } 
var context = canvas.getContext('2d');
var xmax = canvas.width, ymax = canvas.height;
var imageData;
var ballX, ballY;
//var cursorX, cursorY, buttonD = -1;
var i = 0;
var x, y, xnew, ynew, dx, dy;
var angle;
var rmin, rmax, rc, rcmax = 0;
var dist_start = 20, dist_end = 50;
var c

start(); // вызов функции. запуск программы.

function start() {
    ballX = xmax/2; ballY = ymax/2;
    context.strokeStyle = "rgb(255,255,255)";
    context.fillStyle = "rgb(155,15,25)";
    context.beginPath();
    context.arc(ballX, ballY, 2, 0, Math.PI * 2, true);
    context.closePath(); context.stroke(); context.fill();
    
    imageData = context.getImageData(0, 0, xmax, ymax);
    context.putImageData(imageData, 0, 0);
    
    rmin = dist_start, rmax = dist_end;

    //var looper = setInterval(animation_step, 1000 / 4); // 24 кадра в секунду
    var looper = setInterval(animation_step, 0); // максимально быстро
}

function animation_step() {
    //context.clearRect(0, 0, SW, SH); // CLS
    if(i < 17000)
    {
        angle = 2 * Math.PI * Math.random();
        x = xmax/2 + rmin*Math.cos(angle) | 0;
        y = ymax/2 + rmin*Math.sin(angle) | 0;
        rc = rmin;
        c = 0; /* 0 значит точка не установлена */
        while(rc < rmax && c == 0) {
            dx = Math.floor(Math.random() * 3) - 1;
            dy = Math.floor(Math.random() * 3) - 1;
            xnew = x + dx;
            ynew = y + dy;
            rc = Math.sqrt((xnew-xmax/2)*(xnew-xmax/2)+(ynew-ymax/2)*(ynew-ymax/2)) | 0;
            c = getPixel(imageData,xnew,ynew);
            //pset(x,y), 17
            if(rc < rmax && c == 0) {
                x = xnew, y = ynew;
            }
        }
        if(c != 0) {
            i = i + 1;
            countI.innerText = i;
            setPixel(imageData,x,y,128,212,202,255);
            if(rcmax < rc) { rcmax = rc; }
            rmin = rcmax + dist_start;
            rmax = rcmax + dist_end;
            
            context.putImageData(imageData, 0, 0);
        }
    }
}


function setPixel(imageData, x, y, r, g, b, a) {
    var index = (x + y * imageData.width) * 4;
    imageData.data[index+0] = r;
    imageData.data[index+1] = g;
    imageData.data[index+2] = b;
    imageData.data[index+3] = a;
}

function getPixel(imageData, x, y) {
    var index = (x + y * imageData.width) * 4;
    var r = imageData.data[index+0];
    var g = imageData.data[index+1];
    var b = imageData.data[index+2];
    var a = imageData.data[index+3];
    return r+g+b+a;
}

/*
canvas.onmousemove = function(e) {
    e = e || event;
    e.preventDefault();
    cursorX = e.offsetX;
    cursorY = e.offsetY;
}
canvas.onmousedown = function(e) {
    buttonD = e.button;
}
canvas.onmouseup = function(e) {
    buttonD = -1;
}
*/
/*
// рисуем шарик
function drawBall(x,y) {
    context.beginPath();
    //context.arc(this.x, this.y, this.radius, 0, Math.PI * 2, true);
    context.arc(x, y, 10, 0, Math.PI * 2, true);
    context.closePath(); context.stroke(); context.fill();
}
*/

</script>
</html>