<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>emoji robots</title>
    <style>
        html,
        body {
            margin: 0;
            border: 0;
            min-height: 100% !important;
            height: 100%;
            overflow: hidden;
        }

        *,
        *:after,
        *:before {
            box-sizing: border-box;
        }

        [hidden] {
            display: none !important;
        }

        /*https://codepen.io/cjimmy/pen/RwVmgGR?editors=1100*/
        /*https://yoksel.github.io/url-encoder/*/
        .noise_004 {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='nf'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.004' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23nf)'/%3E%3C/svg%3E");
        }

        body {
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: 1fr auto;
        }

        .world {
            grid-column: 1;
            grid-row: 1;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='nf'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.004' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23nf)'/%3E%3C/svg%3E");
            margin: 0px;
            border: 1em dotted #4444;
            height: 100%;
        }

        #error-log {
            grid-column: 1;
            grid-row: 2;
            overflow: scroll;
            height: 10em;
            box-shadow: inset 0 0 9px #0005;
        }

        .robot {
            font-size: xx-large;
            position: absolute;
        }
    </style>
    <script type="text/javascript" src="emoji.js"></script>
</head>

<body>
    <div class="world" id="worldplace"></div>
    <div id="error-log"></div>
</body>

<script>
    /* Перенаправления вывода консольного лога. отсюда  https://stackoverflow.com/questions/6604192/showing-console-errors-and-alerts-in-a-div-inside-the-page  */
    var log = document.querySelector('#error-log');
    ['log', 'debug', 'info', 'warn', 'error'].forEach(function (verb) {
        console[verb] = (function (method, verb, log) {
            return function () {
                method.apply(console, arguments);
                var msg = document.createElement('div');
                msg.classList.add(verb);
                msg.textContent = verb + ': ' + Array.prototype.slice.call(arguments).join(' ');
                log.appendChild(msg);
            };
        })(console[verb], verb, log);
    });
</script>

<script>
    class RobotEmo {
        constructor(w, name, size) {
            this.w = w;
            this.name = name;
            this.size = size;
            console.log(`added robot ${this.name}`);
            this.span = document.createElement('span');
            this.span.classList.add("robot");
            this.span.classList.add(name);
            this.span.textContent = this.w.oRobotTypes[name].s;
            this.w.worldplace.appendChild(this.span);
        }
        MoveStep() {
            console.log(`step of ${this.name}`);
        }
    }

    class World2d {
        constructor(oRobotTypes) {
            this.oRobotTypes = oRobotTypes;
            this.worldplace = document.getElementById("worldplace");
            //this.worldplace.innerHTML = "<span id='slog'>started ...</span>"
            console.log(`constructor World2d: Object.keys(this.oRobotTypes).length=${Object.keys(this.oRobotTypes).length}`);
            this.robots = {};
            for (const [key, val] of Object.entries(this.oRobotTypes)) {
                this.AddRobot(key, val);
                if (Object.keys(this.robots).length > 3) { break; }
            }
            this.gameInterval = null;
        }
        ///
        AddRobot(name) {
            const cntName = Object.values(this.robots).filter(r => r.name == name).length;
            const robotKey = `${name}.${cntName + 1}`;
            this.robots[robotKey] = new RobotEmo(this, name, 1);
        }
        ///
        GameStep() {
            for (const robot of this.robots) {
                robot.MoveStep();
            }
        }
        ///
        RunGame() {
            if (!this.myInterval) {
                this.gameInterval = window.setInterval(() => this.GameStep(), 0);
                console.log(`game STARTED ...`);
            } else { debugger; console.log(`game Already Started !`); }
        }
        ///
        StopGame() {
            if (this.myInterval) {
                window.clearInterval(this.gameInterval);
                console.log(`game OVER .`);
            }
            else { debugger; console.log(`game Was not Started !`); }
        }
    }

    const w2d = new World2d(ObjEmoji);
    w2d.RunGame();
</script>

</html>